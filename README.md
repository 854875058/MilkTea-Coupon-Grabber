# MilkTea-Coupon-Grabber 🧋

奶茶优惠券自动抢券脚本，支持蜜雪冰城、茶百道等品牌。

> ⚠️ **声明：本项目仅供学习交流使用，请勿用于商业用途或恶意抢券。相关活动规则以官方为准。**

## 支持品牌

| 品牌 | 脚本 | 说明 |
|------|------|------|
| 蜜雪冰城 | `蜜雪冰城.py` / `mx.py` / `mx1.py` | 口令抢券，支持多账号、代理池、定时抢券 |
| 茶百道 | `茶百道.py` / `cbd1.py` | 密码抢券，支持异步并发、多账号 |

## 功能特性

- **异步高并发**：基于 `asyncio` + `aiohttp`，单账号可发起大量并发请求
- **多账号支持**：可配置多个账号同时抢券
- **定时抢券**：支持设置目标时间，精确到毫秒级触发
- **代理池**：支持接入第三方代理 API，降低被限制风险（蜜雪冰城脚本）
- **JS 逆向签名**：还原了蜜雪冰城 H5 端的请求签名算法

## 项目结构

```
├── 蜜雪冰城.py        # 蜜雪冰城 - 简易版抢券脚本
├── mx.py              # 蜜雪冰城 - 完整版（代理+定时+多账号）
├── mx1.py             # 蜜雪冰城 - 完整版变体
├── mx.js              # 蜜雪冰城 - 签名算法 JS
├── mx1.js             # 蜜雪冰城 - 签名算法 JS（备用）
├── 茶百道.py           # 茶百道 - 异步并发抢券
├── cbd1.py            # 茶百道 - 多线程+异步版本
├── js加密.js          # JS 加密逻辑分析
├── F3.js              # 前端加密源码
├── params (1).js      # 请求参数构造逻辑
├── test.py / test.js  # 测试脚本
├── token*.txt         # Token 配置文件（示例）
└── completed_tokens.txt / invalid_tokens.txt  # 运行日志
```

## 环境依赖

```bash
pip install aiohttp requests execjs fake_useragent
```

蜜雪冰城脚本还需要 Node.js 环境（用于执行 JS 签名）。

## 使用方式

### 蜜雪冰城

1. 抓包获取小程序的 `Access-Token`
2. 修改 `蜜雪冰城.py` 中的 `token`、`marketingId`、`round`、`secretword` 等参数
3. 运行：
```bash
python 蜜雪冰城.py
```

### 茶百道

1. 抓包获取小程序的 `CSESSION`
2. 修改 `茶百道.py` 中的 `cookie`、`idtime`、`password` 等参数
3. 运行：
```bash
python 茶百道.py
```

## 技术要点

- 蜜雪冰城 H5 端使用了自定义签名算法（`type__1286` 参数），通过 `execjs` 调用还原后的 JS 代码生成
- 请求签名基于 MD5，拼接了固定的 salt 值
- 茶百道使用微信小程序接口，需要有效的 `CSESSION`

## 免责声明

本项目仅用于技术学习和研究目的，不鼓励任何违反平台规则的行为。使用本项目造成的任何后果由使用者自行承担。

## License

MIT
